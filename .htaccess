# ----------------------------------------
# Force HTTPS and www
# ----------------------------------------
RewriteEngine On
RewriteBase /
# Prevent directory listing and content negotiation interfering with rewrites
Options -Indexes -MultiViews
RewriteCond %{HTTPS} off [OR]
RewriteCond %{HTTP_HOST} !^www\.avioncitojuego\.com$ [NC]
RewriteRule ^(.*)$ https://www.avioncitojuego.com/$1 [L,R=301]

# ----------------------------------------
# Redirect index.html → /
# ----------------------------------------
RewriteCond %{THE_REQUEST} /index\.html [NC]
RewriteRule ^index\.html$ https://www.avioncitojuego.com/ [L,R=301]

# ----------------------------------------
# Exclude sitemap.html from redirects
# ----------------------------------------
RewriteCond %{THE_REQUEST} sitemap\.html [NC]
RewriteRule ^ - [L]

# ----------------------------------------
# Redirect old .html URLs → clean URLs
# ----------------------------------------
RewriteCond %{THE_REQUEST} \s/+([^.]+)\.html [NC]
RewriteRule ^([^.]+)\.html$ https://www.avioncitojuego.com/$1 [R=301,L]

# ----------------------------------------
# Explicit mapping for top-level section pages that also have folders
# This prevents 403 when a real directory exists (e.g., /blog/ and /tutorials/)
RewriteRule ^(blog|tutorials)/?$ $1.html [L]

# ----------------------------------------
# Internally serve clean URLs for second-level slugs
# /blog/my-post → /blog/my-post.html
# /tutorials/my-tutorial → /tutorials/my-tutorial.html
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^(blog|tutorials)/([^/]+)/?$ $1/$2.html [L]

# ----------------------------------------
# Internally serve clean URLs as .html files (no redirect)
# ----------------------------------------
RewriteCond %{REQUEST_FILENAME} !-d
RewriteCond %{REQUEST_FILENAME} !-f
RewriteCond %{REQUEST_FILENAME}.html -f
RewriteRule ^([^/]+)/?$ $1.html [L]

# ----------------------------------------
# Security headers
# ----------------------------------------
<IfModule mod_headers.c>
  Header always set X-Content-Type-Options "nosniff"
  Header always set X-Frame-Options "SAMEORIGIN"
  Header always set X-XSS-Protection "1; mode=block"
</IfModule>

# ----------------------------------------
# Compression
# ----------------------------------------
<IfModule mod_deflate.c>
  AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ----------------------------------------
# Browser caching
# ----------------------------------------
<IfModule mod_expires.c>
  ExpiresActive On
  ExpiresByType image/jpg "access plus 1 year"
  ExpiresByType image/jpeg "access plus 1 year"
  ExpiresByType image/gif "access plus 1 year"
  ExpiresByType image/png "access plus 1 year"
  ExpiresByType text/css "access plus 1 month"
  ExpiresByType application/javascript "access plus 1 month"
  ExpiresByType text/javascript "access plus 1 month"
  ExpiresByType text/html "access plus 1 hour"
</IfModule>
